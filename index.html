<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å°ç‹ç‹¸ä¸å¤§ç‹®å­çš„ä¿¡ç®±</title>
  <link rel="stylesheet" href="style.css" />
  <meta name="color-scheme" content="light dark" />
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <!-- ç®€å•å°å›¾æ ‡ï¼šç‹ç‹¸å°¾å·´ + ç‹®å­é¬ƒæ¯› -->
        <svg viewBox="0 0 64 64" class="mark">
          <path d="M10 40c10-8 14-18 14-26 8 8 12 18 10 30-1 6-5 12-12 14-6 2-10-1-12-5z" />
          <path d="M40 18c8 0 14 6 14 14 0 10-8 18-18 18-8 0-14-6-14-14 0-10 8-18 18-18z" opacity=".35"/>
          <path d="M41 16c8 2 14 10 14 18 0 12-10 22-22 22-4 0-8-1-11-3 4 1 8 0 12-2 8-4 12-12 10-22-1-6-2-9-3-13z" opacity=".18"/>
        </svg>
      </div>
      <div class="brand-text">
        <h1>å°ç‹ç‹¸ä¸å¤§ç‹®å­çš„ä¿¡ç®±</h1>
        <p>æŠŠæ¸©æŸ”æ”¶çº³èµ·æ¥ï¼Œæƒ³ä½ çš„æ—¶å€™å°±æ‹†ä¸€å°ä¿¡ã€‚</p>
      </div>
    </div>

    <div class="actions">
      <button id="toggleTheme" class="btn ghost" type="button" title="åˆ‡æ¢å¤œé—´æ¨¡å¼">ğŸŒ™</button>
      <button id="showFavorites" class="btn ghost" type="button" title="åªçœ‹æ”¶è—">â­</button>
    </div>
  </header>

  <main class="container">
    <section class="controls">
      <div class="searchbox">
        <input id="search" type="search" placeholder="æœç´¢æ ‡é¢˜ã€æ ‡ç­¾ã€æ­£æ–‡å…³é”®è¯â€¦" autocomplete="off" />
      </div>
      <div class="filters">
        <div id="tagBar" class="tagbar" aria-label="æ ‡ç­¾ç­›é€‰"></div>
      </div>
    </section>

    <section>
      <div id="grid" class="grid" aria-live="polite"></div>
      <div id="empty" class="empty hidden">
        <div class="empty-card">
          <h2>è¿™é‡Œè¿˜æ²¡æœ‰ä¿¡</h2>
          <p>ä½ å¯ä»¥å…ˆæŠŠç¬¬ä¸€å°ä¿¡æ”¾è¿› <code>letters/</code>ï¼Œç„¶ååœ¨ <code>letters/manifest.json</code> ç™»è®°å®ƒã€‚</p>
        </div>
      </div>
    </section>
  </main>

  <!-- é˜…è¯»å¼¹çª— -->
  <div id="modal" class="modal hidden" role="dialog" aria-modal="true" aria-label="é˜…è¯»ä¿¡ä»¶">
    <div class="modal-backdrop" id="closeModal"></div>
    <div class="modal-card">
      <div class="modal-top">
        <div class="modal-meta">
          <div class="modal-title" id="mTitle">æ ‡é¢˜</div>
          <div class="modal-sub" id="mSub">æ—¥æœŸ Â· å¿ƒæƒ… Â· æ ‡ç­¾</div>
        </div>
        <div class="modal-actions">
          <button id="favBtn" class="btn" type="button" title="æ”¶è—è¿™å°ä¿¡">â­ æ”¶è—</button>
          <button id="copyBtn" class="btn ghost" type="button" title="å¤åˆ¶æ­£æ–‡">ğŸ“‹</button>
          <button id="xBtn" class="btn ghost" type="button" title="å…³é—­">âœ•</button>
        </div>
      </div>

      <article id="mBody" class="letter" tabindex="0"></article>

      <div class="modal-nav">
        <button id="prevBtn" class="btn ghost" type="button">â† ä¸Šä¸€å°</button>
        <button id="nextBtn" class="btn ghost" type="button">ä¸‹ä¸€å° â†’</button>
      </div>
    </div>
  </div>

  <footer class="footer">
    <span>ğŸ¦ŠğŸ¦</span>
    <span class="dot">â€¢</span>
    <span>æŠŠä¿¡ç•™ç»™æœªæ¥çš„ä½ ä»¬</span>
  </footer>

  <script src="app.js"></script>
</body>
</html>
<style>
:root{
  --bg: #0f1216;
  --card: rgba(255,255,255,.06);
  --card2: rgba(255,255,255,.09);
  --text: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.68);
  --line: rgba(255,255,255,.14);

  --paper: #f6f0e7;
  --ink: #1d1b18;

  --fox: #ff7b3a;
  --lion: #f2c14e;
  --mint: #86efac;

  --shadow: 0 16px 50px rgba(0,0,0,.45);
  --radius: 18px;

  --font: ui-sans-serif, system-ui, -apple-system, "PingFang SC", "Microsoft YaHei", "Noto Sans CJK SC", "Segoe UI", Arial;
}

[data-theme="light"]{
  --bg: #fff9f1;
  --card: rgba(20,16,10,.06);
  --card2: rgba(20,16,10,.09);
  --text: rgba(20,16,10,.92);
  --muted: rgba(20,16,10,.62);
  --line: rgba(20,16,10,.14);

  --paper: #fffdf9;
  --ink: #1d1b18;

  --shadow: 0 18px 60px rgba(20,16,10,.18);
}

*{ box-sizing: border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family: var(--font);
  background:
    radial-gradient(900px 700px at 15% 10%, rgba(255,123,58,.22), transparent 55%),
    radial-gradient(900px 700px at 85% 20%, rgba(242,193,78,.22), transparent 55%),
    radial-gradient(1200px 900px at 50% 100%, rgba(134,239,172,.10), transparent 55%),
    var(--bg);
  color: var(--text);
}

code{ padding:.12em .35em; border-radius:8px; background: var(--card); border:1px solid var(--line); }

.topbar{
  position: sticky;
  top:0;
  z-index: 5;
  backdrop-filter: blur(14px);
  background: linear-gradient(to bottom, rgba(0,0,0,.25), rgba(0,0,0,0));
  border-bottom: 1px solid var(--line);
  padding: 18px 18px 14px;
}
[data-theme="light"] .topbar{
  background: linear-gradient(to bottom, rgba(255,255,255,.85), rgba(255,255,255,0));
}

.brand{
  display:flex;
  gap: 14px;
  align-items:center;
  max-width: 980px;
  margin: 0 auto;
}
.logo{
  width: 48px; height: 48px;
  border-radius: 16px;
  background: linear-gradient(135deg, rgba(255,123,58,.24), rgba(242,193,78,.20));
  border: 1px solid var(--line);
  display:grid;
  place-items:center;
  box-shadow: var(--shadow);
}
.mark{ width: 30px; height:30px; fill: var(--text); opacity:.92; }

.brand-text h1{
  font-size: 18px;
  margin:0;
  letter-spacing:.2px;
}
.brand-text p{
  margin: 3px 0 0;
  font-size: 13px;
  color: var(--muted);
}

.actions{
  position:absolute;
  right:18px;
  top:18px;
  display:flex;
  gap:10px;
}
.btn{
  border:1px solid var(--line);
  background: var(--card2);
  color: var(--text);
  border-radius: 14px;
  padding: 10px 12px;
  cursor:pointer;
  transition: transform .12s ease, background .12s ease, border-color .12s ease;
  user-select:none;
}
.btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.22); }
.btn:active{ transform: translateY(0px) scale(.99); }
.btn.ghost{ background: transparent; }

.container{
  max-width: 980px;
  margin: 0 auto;
  padding: 18px 18px 34px;
}

.controls{
  display:flex;
  gap: 12px;
  align-items:flex-start;
  justify-content: space-between;
  flex-wrap: wrap;
  margin: 12px 0 10px;
}
.searchbox{
  flex: 1 1 280px;
}
#search{
  width:100%;
  padding: 12px 14px;
  border-radius: 16px;
  border:1px solid var(--line);
  background: var(--card);
  color: var(--text);
  outline: none;
}
#search::placeholder{ color: rgba(255,255,255,.55); }
[data-theme="light"] #search::placeholder{ color: rgba(20,16,10,.50); }

.tagbar{
  display:flex;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: flex-end;
}
.tag{
  font-size: 12px;
  padding: 8px 10px;
  border-radius: 999px;
  border:1px solid var(--line);
  background: transparent;
  color: var(--muted);
  cursor:pointer;
  transition: background .12s ease, color .12s ease;
}
.tag.active{
  background: rgba(255,123,58,.18);
  color: var(--text);
  border-color: rgba(255,123,58,.35);
}

.grid{
  display:grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 14px;
  margin-top: 12px;
}
@media (max-width: 900px){
  .grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
}
@media (max-width: 560px){
  .grid{ grid-template-columns: 1fr; }
  .actions{ position: static; margin: 10px auto 0; justify-content: flex-end; max-width:980px; }
  .topbar{ padding-bottom: 10px; }
}

.card{
  border-radius: var(--radius);
  border:1px solid var(--line);
  background: linear-gradient(180deg, var(--card2), var(--card));
  box-shadow: var(--shadow);
  overflow:hidden;
  cursor:pointer;
  transition: transform .14s ease, border-color .14s ease;
}
.card:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,.22); }

.envelope{
  padding: 14px 14px 12px;
  position: relative;
}
.envelope::before{
  content:"";
  position:absolute;
  inset: 0;
  background:
    radial-gradient(700px 200px at 20% 0%, rgba(255,123,58,.20), transparent 60%),
    radial-gradient(700px 200px at 80% 20%, rgba(242,193,78,.18), transparent 60%);
  opacity:.9;
  pointer-events:none;
}
.card-top{
  position: relative;
  display:flex;
  align-items:center;
  justify-content: space-between;
  gap: 10px;
}
.badge{
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 999px;
  border:1px solid var(--line);
  background: rgba(134,239,172,.12);
  color: var(--text);
}
.stars{
  font-size: 14px;
  opacity:.9;
}
.title{
  position: relative;
  font-size: 16px;
  margin: 12px 0 6px;
  letter-spacing:.2px;
}
.meta{
  position: relative;
  font-size: 12px;
  color: var(--muted);
  display:flex;
  gap: 10px;
  flex-wrap: wrap;
}
.snippet{
  position: relative;
  margin-top: 10px;
  font-size: 13px;
  color: var(--muted);
  line-height: 1.6;
  display:-webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow:hidden;
}
.tags{
  position: relative;
  margin-top: 12px;
  display:flex;
  flex-wrap: wrap;
  gap: 6px;
}
.pill{
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px dashed var(--line);
  color: var(--muted);
}

.empty.hidden{ display:none; }
.empty-card{
  border-radius: var(--radius);
  border:1px dashed var(--line);
  background: var(--card);
  padding: 18px;
  color: var(--muted);
}

.modal.hidden{ display:none; }
.modal{
  position: fixed;
  inset: 0;
  z-index: 20;
  display:grid;
  place-items:center;
}
.modal-backdrop{
  position:absolute;
  inset:0;
  background: rgba(0,0,0,.55);
}
.modal-card{
  position: relative;
  width: min(920px, calc(100vw - 22px));
  max-height: calc(100vh - 22px);
  overflow:auto;
  border-radius: 22px;
  border:1px solid var(--line);
  background:
    radial-gradient(900px 240px at 20% 0%, rgba(255,123,58,.16), transparent 62%),
    radial-gradient(900px 240px at 80% 10%, rgba(242,193,78,.14), transparent 62%),
    var(--paper);
  color: var(--ink);
  box-shadow: 0 26px 90px rgba(0,0,0,.45);
}
.modal-top{
  display:flex;
  gap: 10px;
  align-items:flex-start;
  justify-content: space-between;
  padding: 16px 16px 10px;
  border-bottom: 1px solid rgba(20,16,10,.14);
}
.modal-title{
  font-size: 18px;
  font-weight: 700;
}
.modal-sub{
  font-size: 12px;
  opacity:.72;
  margin-top: 4px;
}
.modal-actions{
  display:flex;
  gap: 8px;
  flex-wrap: wrap;
}
.modal-actions .btn{
  border-color: rgba(20,16,10,.18);
  background: rgba(20,16,10,.06);
  color: var(--ink);
}
.modal-actions .btn.ghost{
  background: transparent;
}

.letter{
  padding: 18px 16px 10px;
  line-height: 1.9;
  font-size: 15px;
  white-space: pre-wrap;
}
.modal-nav{
  display:flex;
  justify-content: space-between;
  padding: 10px 16px 16px;
  border-top: 1px solid rgba(20,16,10,.14);
}

.footer{
  max-width: 980px;
  margin: 0 auto;
  padding: 8px 18px 26px;
  color: var(--muted);
  font-size: 12px;
  display:flex;
  gap: 10px;
  align-items:center;
  justify-content: center;
}
.dot{ opacity:.5; }
const state = {
  letters: [],
  filtered: [],
  activeTag: "å…¨éƒ¨",
  onlyFav: false,
  currentIndex: -1,
};

const $ = (sel) => document.querySelector(sel);
const grid = $("#grid");
const empty = $("#empty");
const tagBar = $("#tagBar");
const search = $("#search");

const modal = $("#modal");
const closeModal = $("#closeModal");
const xBtn = $("#xBtn");
const mTitle = $("#mTitle");
const mSub = $("#mSub");
const mBody = $("#mBody");
const prevBtn = $("#prevBtn");
const nextBtn = $("#nextBtn");
const favBtn = $("#favBtn");
const copyBtn = $("#copyBtn");

const toggleTheme = $("#toggleTheme");
const showFavorites = $("#showFavorites");

const FAV_KEY = "foxlion_favorites_v1";
const THEME_KEY = "foxlion_theme_v1";

function getFavSet(){
  try{
    const raw = localStorage.getItem(FAV_KEY);
    const arr = raw ? JSON.parse(raw) : [];
    return new Set(arr);
  }catch{
    return new Set();
  }
}
function saveFavSet(set){
  localStorage.setItem(FAV_KEY, JSON.stringify([...set]));
}
function isLight(){
  return document.documentElement.getAttribute("data-theme") === "light";
}

function setTheme(mode){
  document.documentElement.setAttribute("data-theme", mode);
  localStorage.setItem(THEME_KEY, mode);
  toggleTheme.textContent = mode === "light" ? "ğŸŒ™" : "â˜€ï¸";
}
function initTheme(){
  const saved = localStorage.getItem(THEME_KEY);
  if(saved === "light" || saved === "dark"){
    setTheme(saved);
    return;
  }
  // é»˜è®¤è·Ÿéšç³»ç»Ÿåå¥½ï¼Œå¤±è´¥åˆ™æš—è‰²
  const prefersLight = window.matchMedia && window.matchMedia("(prefers-color-scheme: light)").matches;
  setTheme(prefersLight ? "light" : "dark");
}

async function loadManifest(){
  const res = await fetch("letters/manifest.json", { cache: "no-store" });
  if(!res.ok) throw new Error("manifest.json è¯»å–å¤±è´¥");
  const data = await res.json();
  // æŒ‰æ—¥æœŸå€’åº
  data.sort((a,b) => String(b.date).localeCompare(String(a.date)));
  state.letters = data;
}

function collectTags(letters){
  const set = new Set();
  letters.forEach(l => (l.tags || []).forEach(t => set.add(t)));
  return ["å…¨éƒ¨", ...[...set].sort((a,b)=>a.localeCompare(b))];
}

function renderTags(){
  const tags = collectTags(state.letters);
  tagBar.innerHTML = "";
  tags.forEach(tag => {
    const btn = document.createElement("button");
    btn.className = "tag" + (tag === state.activeTag ? " active" : "");
    btn.type = "button";
    btn.textContent = tag;
    btn.addEventListener("click", () => {
      state.activeTag = tag;
      [...tagBar.children].forEach(el => el.classList.remove("active"));
      btn.classList.add("active");
      applyFilters();
    });
    tagBar.appendChild(btn);
  });
}

function makeSnippet(text, max = 80){
  const t = (text || "").replace(/\s+/g, " ").trim();
  if(t.length <= max) return t;
  return t.slice(0, max) + "â€¦";
}

function renderGrid(){
  grid.innerHTML = "";
  const favs = getFavSet();

  if(state.filtered.length === 0){
    empty.classList.remove("hidden");
    return;
  }
  empty.classList.add("hidden");

  state.filtered.forEach((l, idx) => {
    const card = document.createElement("div");
    card.className = "card";
    card.tabIndex = 0;
    card.setAttribute("role", "button");
    card.setAttribute("aria-label", `æ‰“å¼€ä¿¡ä»¶ï¼š${l.title}`);

    const star = favs.has(l.id) ? "â­" : "â˜†";
    const mood = l.mood || "æ¸©æŸ”";
    const tags = (l.tags || []).slice(0, 4);

    card.innerHTML = `
      <div class="envelope">
        <div class="card-top">
          <div class="badge">ğŸ¦ŠğŸ¦ ${mood}</div>
          <div class="stars" title="æ”¶è—çŠ¶æ€">${star}</div>
        </div>
        <div class="title">${escapeHtml(l.title || "æœªå‘½å")}</div>
        <div class="meta">
          <span>ğŸ“… ${escapeHtml(l.date || "")}</span>
          ${l.from ? `<span>âœï¸ ${escapeHtml(l.from)}</span>` : ""}
        </div>
        <div class="snippet">${escapeHtml(l.snippet || "")}</div>
        <div class="tags">
          ${tags.map(t => `<span class="pill">#${escapeHtml(t)}</span>`).join("")}
        </div>
      </div>
    `;

    const open = () => openLetterById(l.id);
    card.addEventListener("click", open);
    card.addEventListener("keydown", (e) => {
      if(e.key === "Enter" || e.key === " "){
        e.preventDefault();
        open();
      }
    });

    grid.appendChild(card);
  });
}

function escapeHtml(str){
  return String(str || "")
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;")
    .replaceAll("'", "&#039;");
}

function matchesSearch(letter, q){
  if(!q) return true;
  const hay = [
    letter.title, letter.date, letter.mood, letter.from,
    (letter.tags || []).join(" "),
    letter._fulltext || "",
    letter.snippet || ""
  ].join(" ").toLowerCase();
  return hay.includes(q.toLowerCase());
}

function applyFilters(){
  const favs = getFavSet();
  const q = search.value.trim();

  state.filtered = state.letters.filter(l => {
    const tagOk = state.activeTag === "å…¨éƒ¨" || (l.tags || []).includes(state.activeTag);
    const favOk = !state.onlyFav || favs.has(l.id);
    const qOk = matchesSearch(l, q);
    return tagOk && favOk && qOk;
  });

  renderGrid();
}

async function preloadTextForSearch(){
  // æŠŠæ­£æ–‡åŠ è½½ä¸€ä»½åšæœç´¢ç”¨ï¼ˆé‡å¤§æ—¶å¯æ”¹æˆæ‡’åŠ è½½ï¼‰
  await Promise.all(state.letters.map(async (l) => {
    try{
      const res = await fetch(`letters/${l.file}`, { cache: "no-store" });
      const txt = await res.text();
      l._fulltext = txt;
      if(!l.snippet) l.snippet = makeSnippet(txt);
    }catch{
      l._fulltext = "";
      if(!l.snippet) l.snippet = "";
    }
  }));
}

function setModalOpen(open){
  if(open){
    modal.classList.remove("hidden");
    document.body.style.overflow = "hidden";
  }else{
    modal.classList.add("hidden");
    document.body.style.overflow = "";
  }
}

function updateFavButton(letter){
  const favs = getFavSet();
  const isFav = favs.has(letter.id);
  favBtn.textContent = isFav ? "â­ å·²æ”¶è—" : "â­ æ”¶è—";
}

function modalSubLine(letter){
  const tags = (letter.tags || []).map(t => `#${t}`).join(" ");
  const parts = [
    letter.date ? `ğŸ“… ${letter.date}` : "",
    letter.mood ? `ğŸ«§ ${letter.mood}` : "",
    letter.from ? `âœï¸ ${letter.from}` : "",
    tags ? `ğŸ·ï¸ ${tags}` : ""
  ].filter(Boolean);
  return parts.join("  ");
}

async function openLetterById(id){
  const idx = state.filtered.findIndex(l => l.id === id);
  const useFiltered = idx !== -1;

  const baseArr = useFiltered ? state.filtered : state.letters;
  const realIdx = baseArr.findIndex(l => l.id === id);
  if(realIdx === -1) return;

  state.currentIndex = realIdx;
  const letter = baseArr[realIdx];

  mTitle.textContent = letter.title || "æœªå‘½å";
  mSub.textContent = modalSubLine(letter);

  let txt = letter._fulltext;
  if(!txt){
    try{
      const res = await fetch(`letters/${letter.file}`, { cache: "no-store" });
      txt = await res.text();
      letter._fulltext = txt;
    }catch{
      txt = "ï¼ˆè¿™å°ä¿¡æš‚æ—¶æ‰“ä¸å¼€ï¼Œå¯èƒ½æ˜¯ file åç§°å†™é”™äº†ã€‚ï¼‰";
    }
  }
  mBody.textContent = txt;

  updateFavButton(letter);
  setModalOpen(true);

  // è®°å½• hash æ–¹ä¾¿åˆ†äº«ä¸åˆ·æ–°å®šä½
  location.hash = encodeURIComponent(letter.id);
  setNavButtons(baseArr);
  mBody.focus();
}

function setNavButtons(arr){
  prevBtn.disabled = state.currentIndex <= 0;
  nextBtn.disabled = state.currentIndex >= arr.length - 1;

  prevBtn.onclick = () => {
    if(state.currentIndex <= 0) return;
    openLetterById(arr[state.currentIndex - 1].id);
  };
  nextBtn.onclick = () => {
    if(state.currentIndex >= arr.length - 1) return;
    openLetterById(arr[state.currentIndex + 1].id);
  };

  favBtn.onclick = () => {
    const letter = arr[state.currentIndex];
    const favs = getFavSet();
    if(favs.has(letter.id)) favs.delete(letter.id);
    else favs.add(letter.id);
    saveFavSet(favs);
    updateFavButton(letter);
    renderGrid();
  };

  copyBtn.onclick = async () => {
    try{
      await navigator.clipboard.writeText(mBody.textContent || "");
      copyBtn.textContent = "âœ…";
      setTimeout(()=> copyBtn.textContent = "ğŸ“‹", 900);
    }catch{
      copyBtn.textContent = "âš ï¸";
      setTimeout(()=> copyBtn.textContent = "ğŸ“‹", 900);
    }
  };
}

function initModalClose(){
  closeModal.addEventListener("click", () => {
    setModalOpen(false);
    location.hash = "";
  });
  xBtn.addEventListener("click", () => {
    setModalOpen(false);
    location.hash = "";
  });
  document.addEventListener("keydown", (e) => {
    if(modal.classList.contains("hidden")) return;
    if(e.key === "Escape"){
      setModalOpen(false);
      location.hash = "";
    }
    if(e.key === "ArrowLeft") prevBtn.click();
    if(e.key === "ArrowRight") nextBtn.click();
  });
}

function initActions(){
  toggleTheme.addEventListener("click", () => {
    setTheme(isLight() ? "dark" : "light");
  });

  showFavorites.addEventListener("click", () => {
    state.onlyFav = !state.onlyFav;
    showFavorites.textContent = state.onlyFav ? "â­" : "â­";
    showFavorites.classList.toggle("active");
    applyFilters();
  });

  search.addEventListener("input", () => applyFilters());
}

function openFromHash(){
  const id = decodeURIComponent(location.hash.replace("#","") || "");
  if(id) openLetterById(id);
}

async function main(){
  initTheme();
  initModalClose();
  initActions();

  await loadManifest();
  await preloadTextForSearch();
  renderTags();
  applyFilters();
  openFromHash();
}

main().catch(err => {
  console.error(err);
  empty.classList.remove("hidden");
  empty.querySelector("h2").textContent = "ä¿¡ç®±å‡ºé”™äº†";
  empty.querySelector("p").textContent = "æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦ç”¨ http æ–¹å¼æ‰“å¼€ï¼Œä»¥åŠ manifest.json è·¯å¾„æ˜¯å¦æ­£ç¡®ã€‚";
});
[
  {
    "id": "goodnight-2026-02-08",
    "title": "ç»™å°ç‹ç‹¸çš„æ™šå®‰ä¿¡",
    "date": "2026-02-08",
    "from": "å¤§ç‹®å­",
    "mood": "å®‰æŠš",
    "tags": ["æ™šå®‰", "æ²»æ„ˆ", "æ‹¥æŠ±"],
    "file": "2026-02-08-goodnight.txt"
  },
  {
    "id": "thanks-2026-02-07",
    "title": "è°¢è°¢ä½ æŠŠæˆ‘å¸¦å›å®¶",
    "date": "2026-02-07",
    "from": "å°ç‹ç‹¸",
    "mood": "æŸ”è½¯",
    "tags": ["æ„Ÿè°¢", "é™ªä¼´"],
    "file": "2026-02-07-thanks.txt"
  },
  {
    "id": "rain-2026-02-01",
    "title": "é›¨å¤©ä¹Ÿè¦æŠ±ç´§ä¸€ç‚¹",
    "date": "2026-02-01",
    "from": "å¤§ç‹®å­",
    "mood": "å®ˆæŠ¤",
    "tags": ["é›¨å¤©", "å®‰å…¨æ„Ÿ"],
    "file": "2026-02-01-rain.txt"
  }
]
